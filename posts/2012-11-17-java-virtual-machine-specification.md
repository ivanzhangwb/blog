---
layout: post
title: "读《Java Virtual Machine Specification》"
permalink: "/2012/book/read-jvm-specification.html"
date: 2012-11-17  
categories: 
- Book
---

  ![Java虚拟机规范(第二版)](http://img3.douban.com/lpic/s4193682.jpg)  
  
  需要说明的是，我读的是国内周志明翻译的中文版，这个版本也是基于最新的JDK7发布的，
  上面的图片只是用来占一个图片的位置的。  
  
  以下是译者提供的电子版链接：  
  [PDF电子版](http://www.icyfenix.com/jvms_javase7_cn/)
  
### 读书笔记  

## P27  
Java虚拟机中引用类型分为: `引用类型` ,`数组类型`,`接口类型` ,其中`引用类型` 含有一个特殊的值 `null` 。  
  
Java虚拟机中的运行时数据区,是用来存储运行时的某些局部数据的，比如临时中间变量值等， 有些运行时数据区是随着JVM启动而创建，随着JVM销毁而销毁。 有些则是随着线程启动和销毁而产生和销毁的。  
  
  	
## P28  
Java虚拟机可以支持多个线程同时执行，每个线程都有自己的`PC寄存器`, 如果JVM不支持Navtive方法，则`PC寄存器`里面存储的是JVM正在执行的字节码指令地址。 如果JVM支持Native方法，则`PC寄存器`里面存储的是`undefine`.  
  
每条JVM线程都有自己私有的`Java虚拟机栈`，这个栈与线程同时创建，用于存储`栈帧(Frame)`,栈帧的主要作用是: `存储局部变量和一些过程结果`。  
  
`Java虚拟机栈`所使用的内存不需要是连续的，并且可以在`堆(Heap)`上进行内存分配.  
  
`Java虚拟机栈` 会存在以下两种情况:  

- 线程请求分配的栈容量超过Java虚拟机栈允许的最大容量时，JVM会抛出`StackoverflowError`异常
- 无法申请到足够的内存去完成栈的扩展，或在建立新的线程时，没有足够的内存去创建虚拟机栈，则会抛出`OutOfMemoryError`异常.


## P29  
Java虚拟机堆允许各个线程共享，`方法区`(HotSpot中称为`持久代`)供线程共享，存类的信息，在JVM启动的时候进行创建。  

## P30  
`运行时常量`: 每一个类/接口的常量池，每一个运行时常量池都分配在JVM的`方法区`中,在类/接口被加载到JVM后，对应的运行时常量就被创建出来。  
  
`本地方法栈`: 主要作用是用来支持Native方法的执行，JVM也可以不支持Native方法的，视不同JVM的实现而不一样.

## P31  
`栈帧`: 主要用来处理运行时部分处理结果、动态链接、方法返回值以及异常分派. 其随着方法的调用而创建，随着方法结束而销毁。  
其内部结构主要由 `局部变量表`,`操作数栈`,`指向当前方法所属类的运行时常量的引用` 构成. 一个线程下，只有当前正在执行的方法的栈帧是活动的。  

## P32  
`局部变量表`:其可以保存的类型有 `boolean`,`byte`,`char`,`short`,`float`,`reference`和`returnAddress`, 其中两个连续的局部变量可以保存一个 `double` 或 `long`  

## P33
`操作数栈`: 其主要包含在每个栈帧的内部， 数据结构为一个LIFO(后进先出)的栈结构。  
举例来说： `iadd` 这条指令是将两个int相加，其内部的处理结构如下:  

-   执行之前，操作数栈顶已经存在两个由前面指令放入的int值
-   将两个数值出栈
-   求两个数值的和
-   将结构重新入栈。  


